<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dels.dao.monitor.TotalityMapper">
    <!-- 获取全省事项维度跑动次数 -->
    <select id="qsys" resultType="java.util.HashMap">
        SELECT (CASE d.PDCS
        WHEN 0 THEN '0次'
        WHEN 1 THEN '1次'
        WHEN 2 THEN
        '2次'
        ELSE '3次+'
        END
        ) name,COUNT(1) y FROM DMS_SXWD d
        <if test="t =='county'">
            inner join tercel.t_dim_areadivide t on d.xzqhqc = t.xzqhqc
            <if test="area!=null and area!='' and area==0">
                AND t.qxsx!=-1
            </if>
        </if>
        WHERE d.FWSXZT='PUBLISHED' AND d.SXLXMC='行政审批'
        <choose>
            <when test="t =='province'">
                AND d.XZQHDM='440000'
                <if test="cparams!=null">
                    AND d.ZZJGMC IN
                    <foreach collection="cparams" item="item" index="index"
                             open="(" close=")" separator=",">
                        #{item}
                    </foreach>
                </if>
            </when>
            <when test="t =='city'">
                AND d.QYJBDM = 3
                <if test="cparams!=null">
                    AND d.SJMC IN
                    <foreach collection="cparams" item="item" index="index"
                             open="(" close=")" separator=",">
                        #{item}
                    </foreach>
                </if>
            </when>
            <when test="t =='county'">
                AND d.QYJBDM = 4
                <if test="area!=null and area!='' and area==0">
                    AND d.XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
                </if>
                <if test="category!=null and category!=''">
                    AND t.qybs = #{category}
                </if>
                <if test="cparams!=null">
                    AND t.sjmc in
                    <foreach collection="cparams" item="item" index="index"
                             open="(" close=")" separator=",">
                        #{item}
                    </foreach>
                </if>
            </when>
            <otherwise>
                <if test="area!=null and area!='' and area==0">
                    AND d.XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
                </if>
            </otherwise>
        </choose>
        GROUP BY name
        ORDER BY name
    </select>
    <!-- 获取全省总体统计(左上角数据) -->
    <select id="itemsurvey" resultType="java.util.HashMap">
        SELECT T1 AS bjzs, T2.swbjzs AS swxzsp, T2.shfwswbjzs AS swshfw, T4 AS sbyw, T2.bjzs AS zxzsp, T2.SHFWBJZS AS zshfw,T7 AS jzbm,T8 As sxzs,T9 AS xzsp,T10 AS shfw FROM
        (SELECT
        (SELECT IFNULL(SUM(BJZS),0) FROM DMS_CORE_COUNT WHERE TJNF = #{year} <![CDATA[ AND TJYF>=#{smonth} AND TJYF<=#{emonth} ]]>
        <if test="area!=null and area!='' and area==0">
            AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if> LIMIT 1) AS T1,
        (SELECT IFNULL(SUM(SWSBZS),0) FROM DMS_CORE_COUNT WHERE TJNF = #{year} <![CDATA[ AND TJYF>=#{smonth} AND TJYF<=#{emonth} ]]>
        <if test="area!=null and area!='' and area==0">
            AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
        LIMIT 1) AS T4,
        (SELECT COUNT(1) FROM DIM_DEPARTMENT
        <if test="area!=null and area!='' and area==0">
            WHERE XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
        LIMIT 1) AS T7,
        (SELECT COUNT(1) FROM DMS_SXWD_HISTORY WHERE FWSXZT = 'PUBLISHED'
        AND NF=#{year} AND YF=#{emonth} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
        <if test="area!=null and area!='' and area==0">
            AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
        LIMIT 1) AS T8,
        (SELECT COUNT(1) FROM DMS_SXWD_HISTORY WHERE SXLXMC='行政审批' AND FWSXZT = 'PUBLISHED'
        AND NF=#{year} AND YF=#{emonth} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
        <if test="area!=null and area!='' and area==0">
            AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
        LIMIT 1) AS T9,
        (SELECT COUNT(1) FROM DMS_SXWD_HISTORY WHERE SXLXMC='公共服务' AND FWSXZT = 'PUBLISHED'
        AND NF=#{year} AND YF=#{emonth} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
        <if test="area!=null and area!='' and area==0">
            AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
        LIMIT 1) AS T10
        FROM DMS_CORE_COUNT LIMIT 1) AS B,
        (
        SELECT ifnull(a.bjzs+b.bjzs+c.bjzs,0) as bjzs,
        ifnull(a.swbjzs+b.swbjzs+c.swbjzs,0) as swbjzs,
        ifnull(a.shfwswbjzs+b.shfwswbjzs+c.shfwswbjzs,0) as shfwswbjzs,
        ifnull(a.SHFWBJZS+b.SHFWBJZS+c.SHFWBJZS,0) as SHFWBJZS
        from
        (select
        'zl' as name,
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.swbjzs),0) as swbjzs,
        ifnull(sum(a.shfwswbjzs),0) as shfwswbjzs,
        ifnull(sum(a.SHFWBJZS),0) as shfwbjzs
        from tercel.T_TJ_SANLV_MX_SZ a
        where a.tjnf=#{year}
        <![CDATA[
         and a.tjyf >= #{smonth}
         and a.tjyf <= #{emonth}
      ]]>
        and left(a.zzjgmc, 3) = '广东省'
        ) A left join
        (select
        'zl' as name,
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.swbjzs),0) as swbjzs,
        ifnull(sum(a.shfwswbjzs),0) as shfwswbjzs,
        ifnull(sum(a.SHFWBJZS),0) as shfwbjzs
        from tercel.T_TJ_SANLV_MX_DS a
        where a.tjnf=#{year}
        <![CDATA[
         and a.tjyf >= #{smonth}
         and a.tjyf <= #{emonth}
      ]]>
        ) B on a.name = b.name
        left join
        (select
        'zl' as name,
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.swbjzs),0) as swbjzs,
        ifnull(sum(a.shfwswbjzs),0) as shfwswbjzs,
        ifnull(sum(a.SHFWBJZS),0) as shfwbjzs
        from tercel.T_TJ_SANLV_MX_QX a
        inner join
        tercel.t_dim_areadivide t on a.xzqhqc = t.xzqhqc and t.qyjbdm=4
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        where a.tjnf=#{year}
        <![CDATA[
         and a.tjyf >= #{smonth}
         and a.tjyf <= #{emonth}
      ]]>
        )C on a.name=c.name
        )T2
    </select>
     <!-- 获取全省级总体统计（左上角数据） -->
    <select id="qsz" resultType="java.util.HashMap">
        SELECT T1 AS bjzs, T2.swbjzs AS swxzsp, T2.shfwswbjzs AS swshfw, T4 AS sbyw, T2.bjzs AS zxzsp, T2.shfwbjzs AS zshfw,T7 AS jzbm,T8 As sxzs,T9 AS xzsp,T10 AS shfw FROM
        (SELECT
        <![CDATA[
            (SELECT IFNULL(SUM(BJZS),0) FROM DMS_CORE_COUNT WHERE TJNF = #{year} AND TJYF>=#{smonth} AND TJYF<=#{emonth} AND XZQHDM='440000'
        ]]>
           <if test="cparams!=null">
                and zzjgmc in
                <foreach collection="cparams" item="item" index="index"
                    open="(" close=")" separator=",">
                    #{item}
                </foreach>
           </if>   LIMIT 1) AS T1,
        <![CDATA[
            (SELECT IFNULL(SUM(SWSBZS),0) FROM DMS_CORE_COUNT WHERE TJNF = #{year} AND TJYF>=#{smonth} AND TJYF<=#{emonth} AND XZQHDM='440000'
        ]]>
            <if test="cparams!=null">
                and zzjgmc in
                <foreach collection="cparams" item="item" index="index"
                    open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>    LIMIT 1) AS T4,
            (SELECT COUNT(1) FROM DIM_DEPARTMENT WHERE XZQHDM='440000'
           <if test="cparams!=null">
            and zzjgmc in
            <foreach collection="cparams" item="item" index="index"
                open="(" close=")" separator=",">
                #{item}
            </foreach>
          </if>    LIMIT 1) AS T7,
            (SELECT COUNT(1) FROM DMS_SXWD_HISTORY WHERE NF=#{year} AND YF=#{emonth} AND FWSXZT ='PUBLISHED' AND XZQHDM='440000' AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
            <if test="cparams!=null">
            and zzjgmc in
            <foreach collection="cparams" item="item" index="index"
                open="(" close=")" separator=",">
                #{item}
            </foreach>
          </if>    LIMIT 1) AS T8,
            (SELECT COUNT(1) FROM DMS_SXWD_HISTORY WHERE NF=#{year} AND YF=#{emonth} AND SXLXMC='行政审批' AND FWSXZT = 'PUBLISHED' AND XZQHDM='440000' AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
            <if test="cparams!=null">
            and zzjgmc in
            <foreach collection="cparams" item="item" index="index"
                open="(" close=")" separator=",">
                #{item}
            </foreach>
          </if>    LIMIT 1) AS T9,
            (SELECT COUNT(1) FROM DMS_SXWD_HISTORY WHERE NF=#{year} AND YF=#{emonth} AND SXLXMC='公共服务' AND FWSXZT = 'PUBLISHED' AND XZQHDM='440000' AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
           <if test="cparams!=null">
            and zzjgmc in
            <foreach collection="cparams" item="item" index="index"
                open="(" close=")" separator=",">
                #{item}
            </foreach>
          </if>    LIMIT 1) AS T10
        FROM DMS_CORE_COUNT LIMIT 1) AS B,
  (
   select
      ifnull(sum(a.BJZS), 0) as bjzs,
      ifnull(sum(a.swbjzs),0) as swbjzs,
      ifnull(sum(a.shfwswbjzs),0) as shfwswbjzs,
      ifnull(sum(a.SHFWBJZS),0) as shfwbjzs
      from tercel.T_TJ_SANLV_MX_SZ a
   where a.tjnf=#{year}
       <![CDATA[
         and a.tjyf >= #{smonth}
         and a.tjyf <= #{emonth}
      ]]>
        and left(a.zzjgmc, 3) = '广东省'
        <if test="cparams!=null">
            and a.zzjgmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
            group by zzjgmc
        </if>
        )T2
    </select>

    <!-- 获取全地市总体统计（左上角数据） -->
    <select id="qds" resultType="java.util.HashMap">
        SELECT T1 AS bjzs, T2.swbjzs AS swxzsp, T2.shfwswbjzs AS swshfw, T4 AS sbyw, T2.bjzs AS zxzsp, T2.shfwbjzs AS zshfw,T7 AS jzbm,T8 As sxzs,T9 AS xzsp,T10 AS shfw FROM
        (SELECT
        (SELECT IFNULL(SUM(BJZS),0) FROM DMS_CORE_COUNT WHERE TJNF = #{year}<![CDATA[ AND TJYF>=#{smonth} AND TJYF<=#{emonth} ]]> AND QYJBDM = 3
        <if test="cparams!=null">
            AND SJMC in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if> LIMIT 1) AS T1,
        (SELECT IFNULL(SUM(SWSBZS),0) FROM DMS_CORE_COUNT WHERE TJNF = #{year} <![CDATA[ AND TJYF>=#{smonth} AND TJYF<=#{emonth} ]]> AND QYJBDM = 3
        <if test="cparams!=null">
            AND SJMC in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if> LIMIT 1) AS T4,
        (SELECT COUNT(1) FROM DIM_DEPARTMENT WHERE QYJBDM = 3
        <if test="cparams!=null">
            AND SJMC in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if> LIMIT 1) AS T7,
        (SELECT COUNT(1) FROM DMS_SXWD_HISTORY WHERE FWSXZT = 'PUBLISHED' AND QYJBDM = 3
        AND NF=#{year} AND YF=#{emonth} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
        <if test="cparams!=null">
            AND SJMC in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if> LIMIT 1) AS T8,
        (SELECT COUNT(1) FROM DMS_SXWD_HISTORY WHERE SXLXMC='行政审批' AND FWSXZT = 'PUBLISHED' AND QYJBDM = 3
        AND NF=#{year} AND YF=#{emonth} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
        <if test="cparams!=null">
            AND SJMC in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if> LIMIT 1) AS T9,
        (SELECT COUNT(1) FROM DMS_SXWD_HISTORY WHERE SXLXMC='公共服务' AND FWSXZT = 'PUBLISHED' AND QYJBDM = 3
        AND NF=#{year} AND YF=#{emonth} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
        <if test="cparams!=null">
            AND SJMC in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if> LIMIT 1) AS T10
        FROM DMS_CORE_COUNT LIMIT 1) AS B,
        (
        select
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.swbjzs),0) as swbjzs,
        ifnull(sum(a.shfwswbjzs),0) as shfwswbjzs,
        ifnull(sum(a.SHFWBJZS),0) as shfwbjzs
        from tercel.T_TJ_SANLV_MX_DS a
        where a.tjnf=#{year}
        <![CDATA[
         and a.tjyf >= #{smonth}
         and a.tjyf <= #{emonth}
      ]]>
        <if test="cparams!=null">
            AND SJMC in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>

        )T2
    </select>

    <!-- 获取全区县总体统计（左上角数据） -->
    <select id="qqx" resultType="java.util.HashMap">
        SELECT
        (SELECT COUNT(1) FROM DIM_DEPARTMENT d
        inner join tercel.t_dim_areadivide t on d.xzqhqc = t.xzqhqc and d.qyjbdm=4
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        <if test="category!=null and category!=''"> AND t.qybs = #{category}</if>
        <if test="cparams!=null">
            AND t.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        ) jzbm,
        (SELECT COUNT(1) FROM DMS_SXWD_HISTORY d
        inner join tercel.t_dim_areadivide t on d.XZQHQC = t.XZQHQC WHERE d.FWSXZT = 'PUBLISHED' AND d.QYJBDM=4
        AND D.NF=#{year} AND D.YF=#{emonth} and d.XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        <if test="category!=null and category!=''"> AND t.qybs = #{category}</if>
        <if test="cparams!=null">
            AND t.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        ) sxzs,
        (SELECT COUNT(1) FROM DMS_SXWD_HISTORY d
        inner join tercel.t_dim_areadivide t on d.XZQHQC = t.XZQHQC WHERE d.SXLXMC='行政审批' AND d.FWSXZT = 'PUBLISHED' AND d.QYJBDM=4
        AND D.NF=#{year} AND D.YF=#{emonth} and d.XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        <if test="category!=null and category!=''"> AND t.qybs = #{category}</if>
        <if test="cparams!=null">
            AND t.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        ) xzsp,
        (SELECT COUNT(1) FROM DMS_SXWD_HISTORY d
        inner join tercel.t_dim_areadivide t on d.XZQHQC = t.XZQHQC WHERE d.SXLXMC='公共服务' AND d.FWSXZT = 'PUBLISHED' AND d.QYJBDM=4
        AND D.NF=#{year} AND D.YF=#{emonth} and d.XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE)
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        <if test="category!=null and category!=''"> AND t.qybs = #{category}</if>
        <if test="cparams!=null">
            AND t.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        ) shfw,T1 AS bjzs, T2.swbjzs AS swxzsp, T2.shfwswbjzs AS swshfw, T4 AS sbyw, T2.bjzs AS zxzsp, T2.shfwbjzs AS zshfw from
        (SELECT
        (SELECT IFNULL(SUM(d.BJZS),0) FROM DMS_CORE_COUNT d inner join tercel.t_dim_areadivide t on d.XZQHQC = t.XZQHQC WHERE d.TJNF = #{year} AND<![CDATA[ d.TJYF>=#{smonth} AND d.TJYF<=#{emonth} ]]>AND d.QYJBDM=4
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        <if test="category!=null and category!=''"> AND t.qybs = #{category}</if>
        <if test="cparams!=null">
            AND t.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if> LIMIT 1) AS T1,
        (SELECT IFNULL(SUM(d.SWSBZS),0) FROM DMS_CORE_COUNT d inner join tercel.t_dim_areadivide t on d.XZQHQC = t.XZQHQC WHERE d.TJNF = #{year} AND <![CDATA[ d.TJYF>=#{smonth} AND d.TJYF<=#{emonth} ]]> AND d.QYJBDM=4
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        <if test="category!=null and category!=''"> AND t.qybs = #{category}</if>
        <if test="cparams!=null">
            AND t.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if> LIMIT 1) AS T4
        FROM DMS_CORE_COUNT LIMIT 1) AS B,
        (
        select
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.swbjzs),0) as swbjzs,
        ifnull(sum(a.shfwswbjzs),0) as shfwswbjzs,
        ifnull(sum(a.SHFWBJZS),0) as shfwbjzs
        from tercel.T_TJ_SANLV_MX_QX a
        inner join
        tercel.t_dim_areadivide t on a.xzqhqc = t.xzqhqc and t.qyjbdm=4
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        <if test="category!=null and category!=''"> AND t.qybs = #{category}</if>
        where a.tjnf=#{year}
        <![CDATA[
         and a.tjyf >= #{smonth}
         and a.tjyf <= #{emonth}
      ]]>
        <if test="cparams!=null">
            AND t.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        )T2
    </select>
      <!-- 获取全省指定年份的三率 -->
    <select id="qssl" resultType="java.util.HashMap">
        SELECT
        (T1.wsqlcsxs+T2.wsqlcsxs+T3.wsqlcsxs) AS wsqlcsxs,
        ifnull((T1.wsqlcsxs+T2.wsqlcsxs+T3.wsqlcsxs)*100/(T1.sxzs+T2.sxzs+T3.sxzs),0.00) AS wsqlcblv,
        (T1.swblzs+T2.swblzs+T3.swblzs) AS swblzs,
        ifnull((T1.swblzs+T2.swblzs+T3.swblzs)*100/(T1.bjzs+T2.bjzs+T3.bjzs),0.00) AS swblv,
        (T1.wsqlcbjzs+T2.wsqlcbjzs+T3.wsqlcbjzs) AS wsqlcbjzs,
        ifnull((T1.wsqlcbjzs+T2.wsqlcbjzs+T3.wsqlcbjzs)*100/(T1.bjzs+T2.bjzs+T3.bjzs),0.00) AS wsbjl,
        (T1.pdcs+T2.pdcs+T3.pdcs) AS pdcs,
        (T1.pdcs0+T2.pdcs0+T3.pdcs0) AS pdcs0,
        ifnull((T1.pdcs0+T2.pdcs0+T3.pdcs0)*100/(T1.pdcs+T2.pdcs+T3.pdcs),0) AS zb0,
        (T1.pdcs1+T2.pdcs1+T3.pdcs1) AS pdcs1,
        ifnull((T1.pdcs1+T2.pdcs1+T3.pdcs1)*100/(T1.pdcs+T2.pdcs+T3.pdcs),0) AS zb1,
        (T1.pdcs2+T2.pdcs2+T3.pdcs2) AS pdcs2,
        ifnull((T1.pdcs2+T2.pdcs2+T3.pdcs2)*100/(T1.pdcs+T2.pdcs+T3.pdcs),0) AS zb2,
        (T1.pdcs3+T2.pdcs3+T3.pdcs3) AS pdcs3,
        ifnull((T1.pdcs3+T2.pdcs3+T3.pdcs3)*100/(T1.pdcs+T2.pdcs+T3.pdcs),0) AS zb3
        FROM
        (SELECT
        'name' as name,
        ifnull(sum(c.wsqlcsxs),0) as wsqlcsxs,
        ifnull(sum(c.sxzs),0) as sxzs,
        ifnull(sum(c.pdcs),0) as pdcs,
        ifnull(sum(c.pdcs0),0) as pdcs0,
        ifnull(sum(c.pdcs1),0) as pdcs1,
        ifnull(sum(c.pdcs2),0) as pdcs2,
        ifnull(sum(c.pdcs3),0) as pdcs3,
        ifnull(sum(c.swblzs),0) as swblzs,
        ifnull(sum(c.bjzs),0) as bjzs,
        ifnull(sum(c.wsqlcbjzs),0) as wsqlcbjzs
        from
        (select a.zzjgmc as name,
        c.wsqlcsxs,
        c.sxzs,
        b.pdcs,
        b.pdcs0,
        b.pdcs1,
        b.pdcs2,
        b.pdcs3,
        a.swblzs,
        a.bjzs,
        a.wsqlcbjzs
        from (select a.zzjgmc,
        ifnull(sum(a.SWBJZS), 0) as swblzs,
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.WSQLCBJZS), 0) as wsqlcbjzs
        from tercel.T_TJ_SANLV_MX_SZ a
        where a.tjnf = #{year}
        <![CDATA[
              and a.tjyf >= #{smonth}
              and a.tjyf <= #{emonth}
     ]]>
        and left(a.zzjgmc, 3) = '广东省'
        group by a.zzjgmc
        ) a
        left join
        (
        SELECT zzjgmc,
        ifnull(pdcs0+pdcs1+pdcs2+pdcs3,0) as pdcs,
        ifnull(pdcs0,0) as pdcs0,
        ifnull(pdcs1,0) as pdcs1,
        ifnull(pdcs2,0) as pdcs2,
        ifnull(pdcs3,0) as pdcs3
        FROM T_TJ_PD_SZ WHERE tjnf=#{year} and tjyf=#{emonth}
        )b on a.zzjgmc=b.zzjgmc
        left join
        (select zzjgmc,
        ifnull(WSQLCSXS,0) as wsqlcsxs,
        ifnull(sxzs,0) as sxzs,
        ifnull(wsqlcsxs*100/sxzs,0) as wsqlcbll
        from tercel.T_TJ_SANLV_MX_SZ
        where tjnf=#{year} and tjyf=#{emonth}
        ) c
        on a.zzjgmc=c.zzjgmc
        ) c
        ) AS T1
        LEFT JOIN
        (SELECT
        'name' as name,
        ifnull(sum(d.wsqlcsxs),0) as wsqlcsxs,
        ifnull(sum(d.sxzs),0) as sxzs,
        ifnull(sum(d.pdcs),0) as pdcs,
        ifnull(sum(d.pdcs0),0) as pdcs0,
        ifnull(sum(d.pdcs1),0) as pdcs1,
        ifnull(sum(d.pdcs2),0) as pdcs2,
        ifnull(sum(d.pdcs3),0) as pdcs3,
        ifnull(sum(d.swblzs),0) as swblzs,
        ifnull(sum(d.bjzs),0) as bjzs,
        ifnull(sum(d.wsqlcbjzs),0) as wsqlcbjzs
        from
        (select a.sjmc as name,
        c.wsqlcsxs,
        c.sxzs,
        b.pdcs,
        b.pdcs0,
        b.pdcs1,
        b.pdcs2,
        b.pdcs3,
        a.swblzs,
        a.bjzs,
        a.wsqlcbjzs
        from (select a.sjmc,
        ifnull(sum(a.SWBJZS), 0) as swblzs,
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.WSQLCBJZS), 0) as wsqlcbjzs
        from tercel.T_TJ_SANLV_MX_DS a
        where a.tjnf = #{year}
        <![CDATA[
              and a.tjyf >= #{smonth}
              and a.tjyf <= #{emonth}
     ]]>
        group by a.sjmc
        ) a
        left join
        (
        SELECT sjmc,
        ifnull(pdcs0+pdcs1+pdcs2+pdcs3,0) as pdcs,
        ifnull(pdcs0,0) as pdcs0,
        ifnull(pdcs1,0) as pdcs1,
        ifnull(pdcs2,0) as pdcs2,
        ifnull(pdcs3,0) as pdcs3
        FROM T_TJ_PD_DS WHERE tjnf=#{year} and tjyf=#{emonth}
        )b on a.sjmc=b.sjmc
        left join
        (SELECT B.SJMC,ifnull(A.C,0) as wsqlcsxs,B.C as sxzs,
        IFNULL(A.C*100/b.c,0) AS WSQLCBLL FROM
        (select sjmc,COUNT(1) C
        from dms_sxwd_history
        where nf=#{year} and yf=#{emonth}
        and fwsxzt='PUBLISHED'  AND SXLXMC='行政审批'
        AND QYJBDM=3 AND SBWSBSSD=3
        GROUP BY SJMC) A
        right JOIN
        (
        select sjmc,COUNT(1) C
        from dms_sxwd_history
        where nf=#{year} and yf=#{emonth}
        and fwsxzt='PUBLISHED'  AND SXLXMC='行政审批'
        AND QYJBDM=3
        GROUP BY SJMC)B ON A.SJMC=B.SJMC
        ) c
        on a.sjmc=c.sjmc
        )as d
        ) AS T2
        ON T1.NAME=T2.NAME
        LEFT JOIN
        (SELECT
        'name' as name,
        ifnull(sum(d.wsqlcsxs),0) as wsqlcsxs,
        ifnull(sum(d.sxzs),0) as sxzs,
        ifnull(sum(d.pdcs),0) as pdcs,
        ifnull(sum(d.pdcs0),0) as pdcs0,
        ifnull(sum(d.pdcs1),0) as pdcs1,
        ifnull(sum(d.pdcs2),0) as pdcs2,
        ifnull(sum(d.pdcs3),0) as pdcs3,
        ifnull(sum(d.swblzs),0) as swblzs,
        ifnull(sum(d.bjzs),0) as bjzs,
        ifnull(sum(d.wsqlcbjzs),0) as wsqlcbjzs
        from
        (select a.xzqhqc as name,
        c.wsqlcsxs,
        c.sxzs,
        b.pdcs,
        b.pdcs0,
        b.pdcs1,
        b.pdcs2,
        b.pdcs3,
        a.swblzs,
        a.bjzs,
        a.wsqlcbjzs
        from (select a.xzqhqc,
        ifnull(sum(a.SWBJZS), 0) as swblzs,
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.WSQLCBJZS), 0) as wsqlcbjzs
        from tercel.T_TJ_SANLV_MX_QX a
        inner join
        tercel.t_dim_areadivide t on a.xzqhqc = t.xzqhqc and t.qyjbdm=4
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        where a.tjnf = #{year}
        <![CDATA[
              and a.tjyf >= #{smonth}
              and a.tjyf <= #{emonth}
     ]]>

        group by a.xzqhqc
        ) a
        left join
        (
        SELECT a.xzqhqc,
        ifnull(a.pdcs0+a.pdcs1+a.pdcs2+a.pdcs3,0) as pdcs,
        ifnull(a.pdcs0,0) as pdcs0,
        ifnull(a.pdcs1,0) as pdcs1,
        ifnull(a.pdcs2,0) as pdcs2,
        ifnull(a.pdcs3,0) as pdcs3
        FROM T_TJ_PD_QX a WHERE tjnf=#{year} and tjyf=#{emonth}
        )b on a.xzqhqc=b.xzqhqc
        left join
        (SELECT B.xzqhqc,IFNULL(A.C,0) as wsqlcsxs,B.C as sxzs,
        IFNULL(A.C*100/b.c,0) AS WSQLCBLL FROM
        (select xzqhqc,COUNT(1) C
        from dms_sxwd_history
        where nf=#{year} and yf=#{emonth}
        and fwsxzt='PUBLISHED'  AND SXLXMC='行政审批'
        AND QYJBDM=4 AND SBWSBSSD=3
        GROUP BY xzqhqc) A
        RIGHT JOIN
        (
        select xzqhqc,COUNT(1) C
        from dms_sxwd_history
        where nf=#{year} and yf=#{emonth}
        and fwsxzt='PUBLISHED'  AND SXLXMC='行政审批'
        AND QYJBDM=4
        GROUP BY xzqhqc)B ON A.xzqhqc=B.xzqhqc
        ) c
        on a.xzqhqc=c.xzqhqc
        )as d
        )AS T3
        ON T1.NAME=T3.NAME
    </select>

    <!-- 获取全省级指定年份的三率 -->
    <select id="qszsl" resultType="java.util.HashMap">
        SELECT
        '广东省' as sjmc, #{year} as tjnf,
        ifnull(sum(c.wsqlcsxs),0) as wsqlcsxs,
        ifnull(sum(c.pdcs),0) as pdcs,
        ifnull(sum(c.pdcs0),0) as pdcs0,
        ifnull(sum(c.pdcs1),0) as pdcs1,
        ifnull(sum(c.pdcs2),0) as pdcs2,
        ifnull(sum(c.pdcs3),0) as pdcs3,
        ifnull(sum(c.wsqlcsxs)*100/sum(c.sxzs),0) as wsqlcblv,
        ifnull(sum(c.swblzs),0) as swblzs,
        ifnull(sum(c.bjzs),0) as bjzs,
        ifnull(sum(c.swblzs)*100/sum(c.bjzs),0) as swblv,
        ifnull(sum(c.wsqlcbjzs),0) as wsqlcbjzs,
        ifnull(sum(c.wsqlcbjzs)*100/sum(c.bjzs),0) as wsbjl
        from
        (select a.zzjgmc as name,
        a.zzjgjc as sname,
        b.pdcs,
        b.pdcs0,
        b.pdcs1,
        b.pdcs2,
        b.pdcs3,
        c.wsqlcsxs,
        c.sxzs,
        c.wsqlcbll,
        a.swblzs,
        a.swbll,
        a.bjzs,
        a.wsbjl,
        a.wsqlcbjzs
        from (select a.zzjgmc,
        a.zzjgjc,
        ifnull(sum(a.SWBJZS), 0) as swblzs,
        ifnull(sum(a.SWBJZS)*100/sum(a.BJZS),0.00) as swbll,
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.WSQLCBJZS)*100/sum(a.BJZSR), 0.00) as wsbjl,
        ifnull(sum(a.WSQLCBJZS), 0) as wsqlcbjzs
        from tercel.T_TJ_SANLV_MX_SZ a
        where a.tjnf = #{year}
        <![CDATA[
              and a.tjyf >= #{smonth}
              and a.tjyf <= #{emonth}
     ]]>
        <if test="cparams!=null">
            and a.zzjgmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        and left(a.zzjgmc, 3) = '广东省'
        group by a.zzjgmc,a.zzjgjc
        ) a
        left join
        (
        SELECT zzjgmc,
        ifnull(pdcs0+pdcs1+pdcs2+pdcs3,0) as pdcs,
        ifnull(pdcs0,0) as pdcs0,
        ifnull(pdcs1,0) as pdcs1,
        ifnull(pdcs2,0) as pdcs2,
        ifnull(pdcs3,0) as pdcs3
        FROM T_TJ_PD_SZ WHERE tjnf=#{year} and tjyf=#{emonth}
        ) b on a.zzjgmc=b.zzjgmc
        left join
        (select zzjgmc,
        ifnull(WSQLCSXS,0) as wsqlcsxs,
        ifnull(sxzs,0) as sxzs,
        ifnull(wsqlcsxs*100/sxzs,0) as wsqlcbll
        from tercel.T_TJ_SANLV_MX_SZ
        where tjnf=#{year} and tjyf=#{emonth}
        ) c
        on a.zzjgmc=c.zzjgmc
        ) c
    </select>

    <!-- 获取全地市指定年份的三率 -->
    <select id="qdssl" resultType="java.util.HashMap">
        SELECT
        #{year} as tjnf,
        ifnull(sum(d.wsqlcsxs),0) as wsqlcsxs,
        ifnull(sum(d.wsqlcsxs)*100/sum(d.sxzs),0) as wsqlcblv,
        ifnull(sum(d.pdcs),0) as pdcs,
        ifnull(sum(d.pdcs0),0) as pdcs0,
        ifnull(sum(d.pdcs1),0) as pdcs1,
        ifnull(sum(d.pdcs2),0) as pdcs2,
        ifnull(sum(d.pdcs3),0) as pdcs3,
        ifnull(sum(d.swblzs),0) as swblzs,
        ifnull(sum(d.bjzs),0) as bjzs,
        ifnull(sum(d.swblzs)*100/sum(d.bjzs),0) as swblv,
        ifnull(sum(d.wsqlcbjzs),0) as wsqlcbjzs,
        ifnull(sum(d.wsqlcbjzs)*100/sum(d.bjzs),0) as wsbjl
        from
        (select a.sjmc as name,
        a.sjmc as sname,
        b.pdcs,
        b.pdcs0,
        b.pdcs1,
        b.pdcs2,
        b.pdcs3,
        c.wsqlcsxs,
        c.sxzs,
        c.wsqlcbll,
        a.swblzs,
        a.swbll,
        a.bjzs,
        a.wsbjl,
        a.wsqlcbjzs
        from (select a.sjmc,
        ifnull(sum(a.SWBJZS), 0) as swblzs,
        ifnull(sum(a.SWBJZS)*100/sum(a.BJZS),0.00) as swbll,
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.WSQLCBJZS)*100/sum(a.BJZSR), 0.00) as wsbjl,
        ifnull(sum(a.WSQLCBJZS), 0) as wsqlcbjzs
        from tercel.T_TJ_SANLV_MX_DS a
        where a.tjnf = #{year}
        <![CDATA[
              and a.tjyf >= #{smonth}
              and a.tjyf <= #{emonth}
     ]]>
        <if test="cparams!=null">
            and a.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        group by a.sjmc
        ) a
        left join
        (
        SELECT sjmc,
        ifnull(pdcs0+pdcs1+pdcs2+pdcs3,0) as pdcs,
        ifnull(pdcs0,0) as pdcs0,
        ifnull(pdcs1,0) as pdcs1,
        ifnull(pdcs2,0) as pdcs2,
        ifnull(pdcs3,0) as pdcs3
        FROM T_TJ_PD_DS WHERE tjnf=#{year} and tjyf=#{emonth}
        ) b on a.sjmc=b.sjmc
        left join
        (SELECT B.SJMC,ifnull(A.C,0) as wsqlcsxs,B.C as sxzs,
        IFNULL(A.C*100/b.c,0) AS WSQLCBLL FROM
        (select sjmc,COUNT(1) C
        from dms_sxwd_history
        where nf=#{year} and yf=#{emonth}
        and fwsxzt='PUBLISHED'  AND SXLXMC='行政审批'
        AND QYJBDM=3 AND SBWSBSSD=3
        GROUP BY SJMC) A
        RIGHT JOIN
        (
        select sjmc,COUNT(1) C
        from dms_sxwd_history
        where nf=#{year} and yf=#{emonth}
        and fwsxzt='PUBLISHED'  AND SXLXMC='行政审批'
        AND QYJBDM=3
        GROUP BY SJMC)B ON A.SJMC=B.SJMC
        ) c
        on a.sjmc=c.sjmc
        )as d

    </select>

    <!-- 获取全区县指定年份的三率 -->
    <select id="qqxsl" resultType="java.util.HashMap">
        SELECT
        #{year} as tjnf,
        ifnull(sum(d.wsqlcsxs),0) as wsqlcsxs,
        ifnull(sum(d.wsqlcsxs)*100/sum(d.sxzs),0) as wsqlcblv,
        ifnull(sum(d.pdcs),0) as pdcs,
        ifnull(sum(d.pdcs0),0) as pdcs0,
        ifnull(sum(d.pdcs1),0) as pdcs1,
        ifnull(sum(d.pdcs2),0) as pdcs2,
        ifnull(sum(d.pdcs3),0) as pdcs3,
        ifnull(sum(d.swblzs),0) as swblzs,
        ifnull(sum(d.bjzs),0) as bjzs,
        ifnull(sum(d.swblzs)*100/sum(d.bjzs),0) as swblv,
        ifnull(sum(d.wsqlcbjzs),0) as wsqlcbjzs,
        ifnull(sum(d.wsqlcbjzs)*100/sum(d.bjzs),0) as wsbjl
        from
        (select a.xzqhqc as name,
        a.xzqhqc as sname,
        b.pdcs,
        b.pdcs0,
        b.pdcs1,
        b.pdcs2,
        b.pdcs3,
        c.wsqlcsxs,
        c.sxzs,
        c.wsqlcbll,
        a.swblzs,
        a.swbll,
        a.bjzs,
        a.wsbjl,
        a.wsqlcbjzs
        from (select a.xzqhqc,t.xzqhdm,
        ifnull(sum(a.SWBJZS), 0) as swblzs,
        ifnull(sum(a.SWBJZS)*100/sum(a.BJZS),0.00) as swbll,
        ifnull(sum(a.BJZS), 0) as bjzs,
        ifnull(sum(a.WSQLCBJZS)*100/sum(a.BJZSR), 0.00) as wsbjl,
        ifnull(sum(a.WSQLCBJZS), 0) as wsqlcbjzs
        from tercel.T_TJ_SANLV_MX_QX a
        inner join
        tercel.t_dim_areadivide t on a.xzqhqc = t.xzqhqc and t.qyjbdm=4
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        where a.tjnf = #{year}
        <![CDATA[
              and a.tjyf >= #{smonth}
              and a.tjyf <= #{emonth}
     ]]>
        <if test="category!=null and category!=''">
            AND t.qybs = #{category}
        </if>
        <if test="cparams!=null">
            AND t.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        group by a.xzqhqc,t.xzqhdm
        ) a
        left join
        (
        SELECT a.xzqhqc,
        ifnull(a.pdcs0+a.pdcs1+a.pdcs2+a.pdcs3,0) as pdcs,
        ifnull(a.pdcs0,0) as pdcs0,
        ifnull(a.pdcs1,0) as pdcs1,
        ifnull(a.pdcs2,0) as pdcs2,
        ifnull(a.pdcs3,0) as pdcs3
        FROM T_TJ_PD_QX a WHERE tjnf=#{year} and tjyf=#{emonth}
        )b on a.xzqhqc=b.xzqhqc
        left join
        (SELECT B.xzqhqc,ifnull(A.C,0) as wsqlcsxs,B.C as sxzs,
        IFNULL(A.C*100/b.c,0) AS WSQLCBLL FROM
        (select xzqhqc,COUNT(1) C
        from dms_sxwd_history
        where nf=#{year} and yf=#{emonth}
        and fwsxzt='PUBLISHED'  AND SXLXMC='行政审批'
        AND QYJBDM=4 AND SBWSBSSD=3
        GROUP BY xzqhqc) A
        right JOIN
        (
        select xzqhqc,COUNT(1) C
        from dms_sxwd_history
        where nf=#{year} and yf=#{emonth}
        and fwsxzt='PUBLISHED'  AND SXLXMC='行政审批'
        AND QYJBDM=4
        GROUP BY xzqhqc)B ON A.xzqhqc=B.xzqhqc
        ) c
        on a.xzqhqc=c.xzqhqc
        )as d
    </select>

    <!-- 全省业务办理 -->
    <select id="qsywblByyf" resultType="int">
        SELECT
        <choose>
            <when test="type==0">
                SUM(d.SWSBZS)
            </when>
            <otherwise>
                SUM(d.BJZS)-SUM(d.SWSBZS)
            </otherwise>
        </choose>
        FROM dms_core_count d
        WHERE d.TJNF=#{year}  
        <![CDATA[ 
            AND d.TJYF>=#{smonth}
            AND d.TJYF<=#{emonth} 
        ]]>
        <if test="area!=null and area!='' and area==0">
            AND d.XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
        GROUP BY TJYF ORDER BY TJYF
    </select>
    <!-- 省级业务办理 -->
    <select id="szywblByyf" resultType="int">
        SELECT
        <choose>
            <when test="type==0">
                SUM(d.SWSBZS)
            </when>
            <otherwise>
                SUM(d.BJZS)-SUM(d.SWSBZS)
            </otherwise>
        </choose>
        FROM dms_core_count d
        WHERE d.TJNF=#{year} 
        AND d.XZQHDM='440000' 
        <![CDATA[ 
            AND d.TJYF>=#{smonth}
            AND d.TJYF<=#{emonth} 
        ]]>
        AND d.XZQHDM='440000'
        GROUP BY TJYF ORDER BY TJYF
    </select>
    <!-- 地市业务办理 -->
    <select id="dsywblByyf" resultType="int">
        SELECT
        <choose>
            <when test="type==0">
                SUM(d.SWSBZS)
            </when>
            <otherwise>
                SUM(d.BJZS)-SUM(d.SWSBZS)
            </otherwise>
        </choose>
        FROM dms_core_count d
        WHERE d.TJNF=#{year} 
        AND d.QYJBDM = 3
        <if test="cparams!=null">  
             AND d.SJMC in
            <foreach collection="cparams" item="item" index="index"
                open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <![CDATA[ 
            AND d.TJYF>=#{smonth}
            AND d.TJYF<=#{emonth} 
        ]]>
        GROUP BY TJYF ORDER BY TJYF
    </select>
    <!-- 区县业务办理 -->
    <select id="qxywblByyf" resultType="int">
        SELECT
        <choose>
            <when test="type==0">
                SUM(d.SWSBZS)
            </when>
            <otherwise>
                SUM(d.BJZS)-SUM(d.SWSBZS)
            </otherwise>
        </choose>
        FROM dms_core_count d
        inner join tercel.t_dim_areadivide t on d.xzqhqc = t.xzqhqc
        <if test="area!=null and area!='' and area==0">
            AND t.qxsx!=-1
        </if>
        WHERE d.TJNF=#{year} 
        AND d.QYJBDM = 4
        <if test="category!=null and category!=''">  
             AND t.qybs = #{category}
        </if>
        <if test="cparams!=null">  
             AND t.SJMC in
            <foreach collection="cparams" item="item" index="index"
                open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <![CDATA[ 
            AND d.TJYF>=#{smonth}
            AND d.TJYF<=#{emonth} 
        ]]>
        GROUP BY TJYF ORDER BY TJYF
    </select>

    <!-- 全省办结业务量排名 -->
    <select id="qsywlph" resultType="java.util.HashMap">
        SELECT T1.SXBM AS id,T2.SXMC AS name, T2.sxlxmc, T1.C AS value FROM
            <![CDATA[
            (SELECT SXBM,SUM(BJZS) C FROM DMS_CORE_COUNT WHERE TJNF=#{year} and TJYF >=#{smonth} AND TJYF <=#{emonth}
            ]]>
        <if test="area == 0">
            AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
            GROUP BY SXBM ORDER BY C DESC) T1
            LEFT JOIN DMS_SXWD_HISTORY T2
            ON T1.SXBM=T2.SXBM
            WHERE T2.SXMC IS NOT NULL AND T2.NF = #{year} AND T2.YF = #{emonth}
        ORDER BY VALUE DESC limit 100
    </select>

    <!-- 省级办结业务量排名 -->
    <select id="szywlph" resultType="java.util.HashMap">
        <![CDATA[
        SELECT T1.ZZJGDM id,T1.ZZJGJC name,IFNULL(T2.C,0) value FROM DIM_DEPARTMENT T1 LEFT JOIN
            (SELECT ZZJGDM,SUM(BJZS) C FROM DMS_CORE_COUNT WHERE TJNF=#{year} and tjyf>=#{smonth} and tjyf<=#{emonth} AND XZQHDM='440000' GROUP BY ZZJGDM) T2
            ON T1.ZZJGDM=T2.ZZJGDM
            WHERE T1.XZQHDM=440000
            ORDER BY 3 DESC
        ]]>
    </select>

    <!-- 地市办结业务量排名 -->
    <select id="dsywlph" resultType="java.util.HashMap">
        SELECT T1.SJMC name,SUM(T2.SM) value
        <![CDATA[
        FROM (SELECT XZQHDM,SJMC FROM T_DIM_AREADIVIDE WHERE XZQHDM <>'440000' AND QYJBDM = 3) T1
        ]]>
        JOIN (SELECT XZQHDM,SUM(BJZS) SM
        FROM DMS_CORE_COUNT
        <![CDATA[
        WHERE TJNF=#{year} and TJYF>=#{smonth} and TJYF<=#{emonth}
        ]]>
        <if test="cparams!=null">
             AND SJMC in
            <foreach collection="cparams" item="item" index="index"
                open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        GROUP BY XZQHDM
        ) T2 ON T1.XZQHDM=T2.XZQHDM
        GROUP BY T1.SJMC
        ORDER BY 2 DESC
    </select>

    <!-- 区县办结业务量排名 -->
    <select id="qxywlph" resultType="java.util.HashMap">
        SELECT IFNULL(T2.XZQHQC,'其他') name,SUM(C) value FROM
        (SELECT XZQHDM,SUM(BJZS) C FROM DMS_CORE_COUNT
        <![CDATA[
        WHERE TJNF=#{year} and tjyf>=#{smonth} and tjyf<=#{emonth} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE WHERE QYJBDM=4)
        ]]>
        <if test="area == 0 or area == '' or area == null">
        AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
        GROUP BY XZQHDM) T1 inner JOIN T_DIM_AREADIVIDE T2
        ON T1.XZQHDM=T2.XZQHDM
        <if test="category!=null and category!=''">
            AND t2.qybs = #{category}
        </if>
        <if test="cparams!=null">
            AND t2.sjmc in
            <foreach collection="cparams" item="item" index="index"
                     open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        GROUP BY NAME
        ORDER BY 2 DESC
    </select>

    <!--计算过程追溯-->
    <select id="szcountChase" parameterType="String" resultType="java.util.Map">
        select zzjgmc,tjsj,bzmc,zbmc,bzwcsj,bzjsjg
        from t_xt_jt_gczs
        where tjsj = #{dateTime}
    </select>

    <!-- 全省办结业务量排名 -->
    <select id="qsbjywlph" resultType="java.util.HashMap">
        SELECT T1.SXBM AS id,T2.SXMC AS name,T2.ZZJGMC as bm,T2.SJMC as ds, T2.sxlxmc, T1.C AS value FROM
        <![CDATA[
            (SELECT SXBM,SUM(BJZS) C FROM CORE_COUNT_HXTJ WHERE  TJRQ >=#{startTime} AND TJRQ <=#{endTime}
            ]]>
        <if test="area == 0">
            AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
        GROUP BY SXBM ORDER BY C DESC) T1
        LEFT JOIN DMS_SXWD_HISTORY T2
        ON T1.SXBM=T2.SXBM
        WHERE T2.SXMC IS NOT NULL AND T2.NF = left(#{endTime},4) AND T2.YF = substr(#{endTime},6,2)
        ORDER BY VALUE DESC limit 100
    </select>

    <!-- 省级办结业务量排名 -->
    <select id="szbjywlph" resultType="java.util.HashMap">
        <![CDATA[
        SELECT T1.ZZJGDM id,T1.ZZJGJC name,IFNULL(T2.C,0) value FROM DIM_DEPARTMENT T1 LEFT JOIN
            (SELECT ZZJGDM,SUM(BJZS) C FROM CORE_COUNT_HXTJ WHERE TJRQ >=#{startTime} AND TJRQ <=#{endTime} AND XZQHDM='440000' GROUP BY ZZJGDM) T2
            ON T1.ZZJGDM=T2.ZZJGDM
            WHERE T1.XZQHDM=440000
            ORDER BY 3 DESC
        ]]>
    </select>

    <!-- 地市办结业务量排名 -->
    <select id="dsbjywlph" resultType="java.util.HashMap">
        SELECT T1.SJMC name,IFNULL(SUM(T2.SM),0) value
        <![CDATA[
        FROM (SELECT XZQHDM,SJMC FROM T_DIM_AREADIVIDE WHERE XZQHDM <>'440000' AND QYJBDM = 3) T1
        ]]>
        JOIN (SELECT XZQHDM,SUM(BJZS) SM
        FROM CORE_COUNT_HXTJ
        <![CDATA[
        WHERE TJRQ >=#{startTime} AND TJRQ <=#{endTime}
        ]]>
        GROUP BY XZQHDM
        ) T2 ON T1.XZQHDM=T2.XZQHDM
        GROUP BY T1.SJMC
        ORDER BY 2 DESC
    </select>

    <!-- 区县办结业务量排名 -->
    <select id="qxbjywlph" resultType="java.util.HashMap">
        <if test="area == 1">
            SELECT IFNULL(T2.XZQHQC,'其他') name, IFNULL(SUM(C),0) value FROM
            (SELECT XZQHDM,SUM(BJZS) C FROM CORE_COUNT_HXTJ
            <![CDATA[
        WHERE TJRQ >=#{startTime} AND TJRQ <=#{endTime} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE WHERE QYJBDM=4)
        ]]>
            GROUP BY XZQHDM) T1 inner JOIN T_DIM_AREADIVIDE T2
            ON T1.XZQHDM=T2.XZQHDM
            <if test="category!=null and category!=''">
                AND t2.qybs = #{category}
            </if>
            GROUP BY NAME
            ORDER BY 2 DESC
        </if>

        <if test="area == 0 or area == '' or area == null">
            SELECT IFNULL(T2.XZQHQC,'其他') name, IFNULL(SUM(C),0) value FROM
            (SELECT XZQHDM,SUM(BJZS) C FROM CORE_COUNT_HXTJ
            <![CDATA[
        WHERE TJRQ >=#{startTime} AND TJRQ <=#{endTime} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE WHERE QYJBDM=4)
        AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        ]]>
            GROUP BY XZQHDM) T1 INNER JOIN T_DIM_AREADIVIDE T2
            ON T1.XZQHDM=T2.XZQHDM
            <if test="category!=null and category!=''">
                AND t2.qybs = #{category}
            </if>
            GROUP BY NAME
            ORDER BY 2 DESC
        </if>
    </select>

    <!-- 指定某个省级部门——事项维度业务量排名 -->
    <select id="szbjywlphDetail" resultType="java.util.HashMap">
        <![CDATA[
			select sxbm,sxmc,sxlxmc,sum(bjzs) as value from CORE_COUNT_HXTJ
			where TJRQ >=#{startTime} AND TJRQ <=#{endTime} and xzqhdm = '440000' and zzjgdm = #{id} and sxmc is not null
			group by sxbm,sxmc,sxlxmc
			order by value desc
        ]]>
    </select>

    <!-- 指定某个地市——事项维度业务量排名 -->
    <select id="dsbjywlphDetail" resultType="java.util.HashMap">
        <![CDATA[
			select T1.sxbm,T1.sxmc,T1.sxlxmc,T1.value,T2.zzjgmc  from(
			select sxbm,sxmc,sxlxmc,sum(bjzs) as value from CORE_COUNT_HXTJ
			where TJRQ >=#{startTime} AND TJRQ <=#{endTime} and xzqhdm IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE WHERE SJMC=#{id} and qyjbdm = 3)  and sxmc is not null
			group by sxbm,sxmc,sxlxmc) T1
			inner join dms_sxwd_history T2
			on T1.sxbm = T2.sxbm and T2.NF = left(#{endTime},4) AND T2.YF = substr(#{endTime},6,2) and t2.sjmc in (#{id},'广东省')
			order by CASE LEFT(T2.zzjgmc,3)  WHEN '广东省' THEN 2  ELSE 1 END,value desc
        ]]>
    </select>

    <!-- 指定某个区县——事项维度业务量排名 -->
    <select id="qxbjywlphDetail" resultType="java.util.HashMap">
         <![CDATA[
			select T1.sxbm,T1.sxmc,T1.sxlxmc,T1.value, T2.zzjgmc  from(
			select sxbm,sxmc,sxlxmc,sum(bjzs) as value from CORE_COUNT_HXTJ
			where TJRQ >=#{startTime} AND TJRQ <=#{endTime} and xzqhdm in (SELECT XZQHDM FROM T_DIM_AREADIVIDE WHERE xzqhqc=#{id} and qyjbdm = 4) and sxmc is not null
			group by sxbm,sxmc,sxlxmc) T1
			inner join dms_sxwd_history T2
			on T1.sxbm = T2.sxbm  and T2.NF = left(#{endTime},4) AND T2.YF = substr(#{endTime},6,2) and t2.sjmc in(#{sjmc},'广东省')
			order by CASE LEFT(T2.zzjgmc,3)  WHEN '广东省' THEN 2  ELSE 1 END,value desc
        ]]>
    </select>

    <!-- 全省申办业务量排名 -->
    <select id="qssbywlph" resultType="java.util.HashMap">
        SELECT T1.SXBM AS id,T2.SXMC AS name,T2.ZZJGMC AS bm, T2.SJMC AS ds, T2.sxlxmc, T1.C AS value FROM
        <![CDATA[
            (SELECT SXBM,SUM(sbzs) C FROM sb_hxtj WHERE TJRQ >=#{startTime} AND TJRQ <=#{endTime}
            ]]>
        <if test="area == 0">
            AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        </if>
        GROUP BY SXBM ORDER BY C DESC) T1
        LEFT JOIN DMS_SXWD_HISTORY T2
        ON T1.SXBM=T2.SXBM
        WHERE T2.SXMC IS NOT NULL AND T2.NF = left(#{endTime},4) AND T2.YF = substr(#{endTime},6,2)
        ORDER BY VALUE DESC limit 100
    </select>

    <!-- 省级申办业务量排名 -->
    <select id="szsbywlph" resultType="java.util.HashMap">
        <![CDATA[
        SELECT A.zzjgdm as id,A.zzjgjc as name, SUM(A.SBZS) AS value FROM (
            SELECT T1.SXBM,T1.SXMC,T1.ZZJGDM,T1.ZZJGMC,T1.ZZJGJC, IFNULL(T2.C,0)AS SBZS FROM
            (SELECT SXBM,SXMC,SXLXMC,SSBMZZJGDM AS ZZJGDM,ZZJGMC,ZZJGJC FROM DMS_SXWD_HISTORY WHERE NF=left(#{endTime},4) AND YF=substr(#{endTime},6,2) AND QYJBDM=2 )T1
            LEFT JOIN
            (SELECT  SXBM,SUM(SBZS) C FROM SB_HXTJ
            WHERE QYJBDM=2 AND TJRQ >=#{startTime} AND TJRQ <=#{endTime}
             GROUP BY SXBM) T2 ON T1.SXBM=T2.SXBM
            ) A GROUP BY A.ZZJGDM,A.ZZJGMC,A.ZZJGJC
            ORDER BY value DESC
        ]]>
    </select>

    <!-- 地市申办业务量排名 -->
    <select id="dssbywlph" resultType="java.util.HashMap">
        SELECT T1.SJMC name,SUM(T2.SM) value
        <![CDATA[
        FROM (SELECT XZQHDM,SJMC FROM T_DIM_AREADIVIDE WHERE XZQHDM <>'440000' AND QYJBDM = 3) T1
        ]]>
        JOIN (SELECT XZQHDM,SUM(sbzs) SM
        FROM sb_hxtj
        <![CDATA[
        WHERE TJRQ >=#{startTime} AND TJRQ <=#{endTime}
        ]]>
        GROUP BY XZQHDM
        ) T2 ON T1.XZQHDM=T2.XZQHDM
        GROUP BY T1.SJMC
        ORDER BY 2 DESC
    </select>

    <!-- 区县申办业务量排名 -->
    <select id="qxsbywlph" resultType="java.util.HashMap">
        <if test="area == 1">
            SELECT IFNULL(T2.XZQHQC,'其他') name,SUM(C) value FROM
            (SELECT XZQHDM,SUM(sbzs) C FROM sb_hxtj
            <![CDATA[
        WHERE TJRQ >=#{startTime} AND TJRQ <=#{endTime} AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE WHERE QYJBDM=4)
        ]]>
            GROUP BY XZQHDM) T1 inner JOIN T_DIM_AREADIVIDE T2
            ON T1.XZQHDM=T2.XZQHDM
            <if test="category!=null and category!=''">
                AND t2.qybs = #{category}
            </if>
            GROUP BY NAME
            ORDER BY 2 DESC
        </if>

        <if test="area == 0 or area == '' or area == null">
            SELECT IFNULL(T2.XZQHQC,'其他') name,SUM(C) value FROM
            (SELECT XZQHDM,SUM(sbzs) C FROM sb_hxtj
            <![CDATA[
        WHERE TJRQ >=#{startTime} AND TJRQ <=#{endTime}  AND XZQHDM IN (SELECT XZQHDM FROM T_DIM_AREADIVIDE WHERE QYJBDM=4)
        AND XZQHDM NOT IN(SELECT XZQHDM FROM TERCEL.t_dim_areadivide WHERE QYJBDM=4 AND QXSX=-1)
        ]]>
            GROUP BY XZQHDM) T1 INNER JOIN T_DIM_AREADIVIDE T2
            ON T1.XZQHDM=T2.XZQHDM
            <if test="category!=null and category!=''">
                AND t2.qybs = #{category}
            </if>
            GROUP BY NAME
            ORDER BY 2 DESC
        </if>
    </select>

    <!-- 指定某个省级部门——事项维度申办业务量排名 -->
    <select id="szsbywlphDetail" resultType="java.util.HashMap">
        <![CDATA[
        SELECT T1.sxbm,T1.sxmc,T1.zzjgdm,T1.zzjgmc,T1.sxlxmc, IFNULL(T2.C,0)AS value FROM
        (SELECT SXBM,SXMC,SXLXMC,SSBMZZJGDM AS ZZJGDM,ZZJGMC FROM DMS_SXWD_HISTORY WHERE NF=left(#{endTime},4) AND YF=substr(#{endTime},6,2) AND QYJBDM=2 )T1
        LEFT JOIN
        (SELECT  SXBM,SUM(SBZS) C FROM SB_HXTJ
        WHERE QYJBDM=2 AND TJRQ >=#{startTime} AND TJRQ <=#{endTime}
         GROUP BY SXBM) T2 ON T1.SXBM=T2.SXBM
         WHERE T1.ZZJGDM=#{id} AND T2.C>0
         ORDER BY value DESC
        ]]>
    </select>

    <!-- 指定某个地市——事项维度申办业务量排名 -->
    <select id="dssbywlphDetail" resultType="java.util.HashMap">
        <![CDATA[
        select T1.sxbm,T1.sxmc,T1.sxlxmc,T1.value,T2.zzjgmc  from(
        select sxbm,sxmc,sxlxmc,sum(sbzs) as value from sb_hxtj
        where TJRQ >=#{startTime} AND TJRQ <=#{endTime} and xzqhdm <> '440000' and sjmc = #{id} and qyjbdm = 3 and sxmc is not null
        group by sxbm,sxmc,sxlxmc) T1
        inner join dms_sxwd_history T2
        on T1.sxbm = T2.sxbm and T2.NF=left(#{endTime},4) and T2.YF=substr(#{endTime},6,2) and t2.sjmc in (#{id},'广东省')
        order by CASE LEFT(T2.zzjgmc,3)  WHEN '广东省' THEN 2  ELSE 1 END,value desc
        ]]>
    </select>

    <!-- 指定某个区县——事项维度申办业务量排名 -->
    <select id="qxsbywlphDetail" resultType="java.util.HashMap">
        <![CDATA[
        select T1.sxbm,T1.sxmc,T1.sxlxmc,T1.value, T2.zzjgmc  from(
		select sxbm,sxmc,sxlxmc,sum(sbzs) as value from sb_hxtj
        where TJRQ >=#{startTime} AND TJRQ <=#{endTime} and xzqhdm <> '440000' and xzqhqc = #{id} and qyjbdm = 4 and sxmc is not null
        group by sxbm,sxmc,sxlxmc) T1
        inner join dms_sxwd_history T2
        on T1.sxbm = T2.sxbm  and T2.NF=left(#{endTime},4) and T2.YF=substr(#{endTime},6,2) and t2.sjmc in(#{sjmc},'广东省')
        order by CASE LEFT(T2.zzjgmc,3)  WHEN '广东省' THEN 2  ELSE 1 END,value desc
        ]]>
    </select>

</mapper>